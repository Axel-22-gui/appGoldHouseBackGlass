/****** Object:  StoredProcedure [dbo].[UserRegistro]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[UserRegistro]
GO
/****** Object:  StoredProcedure [dbo].[Userlogin]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[Userlogin]
GO
/****** Object:  StoredProcedure [dbo].[userForgotPass]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[userForgotPass]
GO
/****** Object:  StoredProcedure [dbo].[upgradearCuenta]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[upgradearCuenta]
GO
/****** Object:  StoredProcedure [dbo].[SeguiListarVendidos]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[SeguiListarVendidos]
GO
/****** Object:  StoredProcedure [dbo].[SeguiListarComprador]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[SeguiListarComprador]
GO
/****** Object:  StoredProcedure [dbo].[RechazarOferta]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[RechazarOferta]
GO
/****** Object:  StoredProcedure [dbo].[publicacionSeleccionarUsu]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[publicacionSeleccionarUsu]
GO
/****** Object:  StoredProcedure [dbo].[publicacionSeleccionar]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[publicacionSeleccionar]
GO
/****** Object:  StoredProcedure [dbo].[publicacionListar]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[publicacionListar]
GO
/****** Object:  StoredProcedure [dbo].[publicacionFiltros1]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[publicacionFiltros1]
GO
/****** Object:  StoredProcedure [dbo].[publicacionFiltros]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[publicacionFiltros]
GO
/****** Object:  StoredProcedure [dbo].[publicacionenprocesoUsu]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[publicacionenprocesoUsu]
GO
/****** Object:  StoredProcedure [dbo].[publicacionCulminadoUsu]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[publicacionCulminadoUsu]
GO
/****** Object:  StoredProcedure [dbo].[publicacionComprasUsu]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[publicacionComprasUsu]
GO
/****** Object:  StoredProcedure [dbo].[publiAgregarDetallePubli]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[publiAgregarDetallePubli]
GO
/****** Object:  StoredProcedure [dbo].[publiAgregar]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[publiAgregar]
GO
/****** Object:  StoredProcedure [dbo].[maximoMinimoFiltros]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[maximoMinimoFiltros]
GO
/****** Object:  StoredProcedure [dbo].[listarSeguimientos]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[listarSeguimientos]
GO
/****** Object:  StoredProcedure [dbo].[listarOfertasPendientes]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[listarOfertasPendientes]
GO
/****** Object:  StoredProcedure [dbo].[listarOfertasenCurso]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[listarOfertasenCurso]
GO
/****** Object:  StoredProcedure [dbo].[listarOfertasCulminidas]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[listarOfertasCulminidas]
GO
/****** Object:  StoredProcedure [dbo].[ListarOfertaAceptadasPubli]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[ListarOfertaAceptadasPubli]
GO
/****** Object:  StoredProcedure [dbo].[ListarOfertaAceptadas]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[ListarOfertaAceptadas]
GO
/****** Object:  StoredProcedure [dbo].[ListarOfertaAceptadaporCliente]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[ListarOfertaAceptadaporCliente]
GO
/****** Object:  StoredProcedure [dbo].[listarIncidencias]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[listarIncidencias]
GO
/****** Object:  StoredProcedure [dbo].[imgListaById]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[imgListaById]
GO
/****** Object:  StoredProcedure [dbo].[editarUsuario]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[editarUsuario]
GO
/****** Object:  StoredProcedure [dbo].[detViviMostrar]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[detViviMostrar]
GO
/****** Object:  StoredProcedure [dbo].[AgregarTransaccion]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[AgregarTransaccion]
GO
/****** Object:  StoredProcedure [dbo].[AgregarRespuesta]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[AgregarRespuesta]
GO
/****** Object:  StoredProcedure [dbo].[AgregarOferta]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[AgregarOferta]
GO
/****** Object:  StoredProcedure [dbo].[AgregarIncidencia]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[AgregarIncidencia]
GO
/****** Object:  StoredProcedure [dbo].[AgregarImagenes]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[AgregarImagenes]
GO
/****** Object:  StoredProcedure [dbo].[AceptarOferta]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP PROCEDURE IF EXISTS [dbo].[AceptarOferta]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Usuario]') AND type in (N'U'))
ALTER TABLE [dbo].[Usuario] DROP CONSTRAINT IF EXISTS [pk_User_TipoDoc]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Transaccion1]') AND type in (N'U'))
ALTER TABLE [dbo].[Transaccion1] DROP CONSTRAINT IF EXISTS [fk_grupo]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Seguimientos]') AND type in (N'U'))
ALTER TABLE [dbo].[Seguimientos] DROP CONSTRAINT IF EXISTS [fkseguiofe]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Publicacion]') AND type in (N'U'))
ALTER TABLE [dbo].[Publicacion] DROP CONSTRAINT IF EXISTS [Pk_Publi_Usuario]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Oferta]') AND type in (N'U'))
ALTER TABLE [dbo].[Oferta] DROP CONSTRAINT IF EXISTS [fkofetusu]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Oferta]') AND type in (N'U'))
ALTER TABLE [dbo].[Oferta] DROP CONSTRAINT IF EXISTS [fkofetpubli]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Imagenes]') AND type in (N'U'))
ALTER TABLE [dbo].[Imagenes] DROP CONSTRAINT IF EXISTS [pk_imgPubli]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Detalles_casa]') AND type in (N'U'))
ALTER TABLE [dbo].[Detalles_casa] DROP CONSTRAINT IF EXISTS [pk_transVivi]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Detalles_casa]') AND type in (N'U'))
ALTER TABLE [dbo].[Detalles_casa] DROP CONSTRAINT IF EXISTS [pk_transDetalle]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Usuario]') AND type in (N'U'))
ALTER TABLE [dbo].[Usuario] DROP CONSTRAINT IF EXISTS [DF__Usuario__Estado__6A30C649]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Usuario]') AND type in (N'U'))
ALTER TABLE [dbo].[Usuario] DROP CONSTRAINT IF EXISTS [DF__Usuario__Valorac__693CA210]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Usuario]') AND type in (N'U'))
ALTER TABLE [dbo].[Usuario] DROP CONSTRAINT IF EXISTS [DF__Usuario__Valorac__68487DD7]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Usuario]') AND type in (N'U'))
ALTER TABLE [dbo].[Usuario] DROP CONSTRAINT IF EXISTS [DF__Usuario__Ventas___6754599E]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Usuario]') AND type in (N'U'))
ALTER TABLE [dbo].[Usuario] DROP CONSTRAINT IF EXISTS [DF__Usuario__Compra___66603565]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Detalle_vivienda]') AND type in (N'U'))
ALTER TABLE [dbo].[Detalle_vivienda] DROP CONSTRAINT IF EXISTS [DF__Detalle_v__Statu__787EE5A0]
GO
/****** Object:  Table [dbo].[Usuario]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP TABLE IF EXISTS [dbo].[Usuario]
GO
/****** Object:  Table [dbo].[Transaccion1]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP TABLE IF EXISTS [dbo].[Transaccion1]
GO
/****** Object:  Table [dbo].[TipoDocumento]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP TABLE IF EXISTS [dbo].[TipoDocumento]
GO
/****** Object:  Table [dbo].[Seguimientos]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP TABLE IF EXISTS [dbo].[Seguimientos]
GO
/****** Object:  Table [dbo].[Publicacion]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP TABLE IF EXISTS [dbo].[Publicacion]
GO
/****** Object:  Table [dbo].[Oferta]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP TABLE IF EXISTS [dbo].[Oferta]
GO
/****** Object:  Table [dbo].[Imagenes]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP TABLE IF EXISTS [dbo].[Imagenes]
GO
/****** Object:  Table [dbo].[Detalles_casa]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP TABLE IF EXISTS [dbo].[Detalles_casa]
GO
/****** Object:  Table [dbo].[Detalle_vivienda]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP TABLE IF EXISTS [dbo].[Detalle_vivienda]
GO
/****** Object:  UserDefinedFunction [dbo].[vendida]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP FUNCTION IF EXISTS [dbo].[vendida]
GO
/****** Object:  UserDefinedFunction [dbo].[retornarRespuesta]    Script Date: 18/04/2022 02:50:56 p. m. ******/
DROP FUNCTION IF EXISTS [dbo].[retornarRespuesta]
GO
/****** Object:  UserDefinedFunction [dbo].[retornarRespuesta]    Script Date: 18/04/2022 02:50:56 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[retornarRespuesta] (@idSeg INT)
RETURNS VARCHAR(200)
AS
BEGIN
	DECLARE @Respuesta VARCHAR(200);
	IF ((select Respuesta from Seguimientos where Id_seguimiento = @idSeg) IS NOT NULL)
	BEGIN
		SET @Respuesta = (select Respuesta from Seguimientos where Id_seguimiento = @idSeg);
	END;
	ELSE
	BEGIN
		SET @Respuesta = 'No Atendido'
	END;
	RETURN @Respuesta;
END;
GO
/****** Object:  UserDefinedFunction [dbo].[vendida]    Script Date: 18/04/2022 02:50:56 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--CREATE PROCEDURE publicacionSeleccionarUsu @idUsu INT
--AS
--BEGIN

--SELECT
--	pub.Titutlo_anuncio AS 'Titulo',
--	pub.localizacion,
--	pub.Precio,
--	pub.Area,
--	CASE
--	WHEN
--	WHEN
--	FROM Publicacion AS pub INNER JOIN Oferta AS ofe ON pub.Id_publicaciones = ofe.Id_publicacion ;
--END;

CREATE FUNCTION [dbo].[vendida] (@idPub INT)
RETURNS BIT
AS
BEGIN
DECLARE @response BIT;
	IF EXISTS(SELECT * FROM Oferta WHERE Id_publicacion = @idPub AND estado NOT IN(0,2))
	BEGIN 
		SET @response = CAST(1 AS BIT)
	END
	ELSE
	BEGIN
		SET @response = CAST(0 AS BIT)
	END;
	RETURN @response;
END;



GO
/****** Object:  Table [dbo].[Detalle_vivienda]    Script Date: 18/04/2022 02:50:56 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Detalle_vivienda](
	[Id_detalle] [int] IDENTITY(1,1) NOT NULL,
	[descripcion_detalles] [varchar](200) NOT NULL,
	[Status] [int] NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[Id_detalle] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Detalles_casa]    Script Date: 18/04/2022 02:50:56 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Detalles_casa](
	[id_vivienda] [int] NOT NULL,
	[id_detalle] [int] NOT NULL,
	[Cantidad] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Imagenes]    Script Date: 18/04/2022 02:50:56 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Imagenes](
	[Id_Imagenes] [int] IDENTITY(1,1) NOT NULL,
	[RutasImagenes] [text] NULL,
	[id_publicacion] [int] NOT NULL,
	[tipo] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[Id_Imagenes] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Oferta]    Script Date: 18/04/2022 02:50:56 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Oferta](
	[Id_oferta] [int] IDENTITY(1,1) NOT NULL,
	[Fecha] [datetime] NULL,
	[Id_publicacion] [int] NOT NULL,
	[Id_usuario] [int] NOT NULL,
	[monto] [decimal](18, 2) NULL,
	[estado] [tinyint] NULL,
 CONSTRAINT [PK_Oferta] PRIMARY KEY CLUSTERED 
(
	[Id_oferta] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Publicacion]    Script Date: 18/04/2022 02:50:56 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Publicacion](
	[Id_publicaciones] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](200) NOT NULL,
	[localizacion] [varchar](200) NOT NULL,
	[longitud] [decimal](18, 12) NOT NULL,
	[latitud] [decimal](18, 12) NOT NULL,
	[Precio] [decimal](18, 2) NOT NULL,
	[Tipo] [varchar](50) NOT NULL,
	[Area] [decimal](7, 2) NOT NULL,
	[Status] [tinyint] NOT NULL,
	[Id_usuario] [int] NOT NULL,
	[Titutlo_anuncio] [varchar](200) NOT NULL,
	[Favoritos] [bit] NOT NULL,
	[Fecha_postventa] [datetime] NULL,
	[provincia] [varchar](200) NULL,
PRIMARY KEY CLUSTERED 
(
	[Id_publicaciones] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Seguimientos]    Script Date: 18/04/2022 02:50:56 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Seguimientos](
	[Id_seguimiento] [int] IDENTITY(1,1) NOT NULL,
	[Mensaje] [text] NULL,
	[Fecha_incidente] [datetime] NULL,
	[Respuesta] [text] NULL,
	[Fecha_respuesta] [datetime] NULL,
	[Status] [tinyint] NULL,
	[id_oferta] [int] NOT NULL,
 CONSTRAINT [PK_Seguimientos] PRIMARY KEY CLUSTERED 
(
	[Id_seguimiento] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TipoDocumento]    Script Date: 18/04/2022 02:50:56 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TipoDocumento](
	[idTipo] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[idTipo] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Transaccion1]    Script Date: 18/04/2022 02:50:56 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Transaccion1](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[idusuario] [int] NOT NULL,
	[tarjeta] [varchar](255) NULL,
	[ccv] [varchar](3) NULL,
	[mes] [int] NULL,
	[anio] [int] NULL,
	[monto] [decimal](18, 2) NULL,
	[titular] [varchar](200) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Usuario]    Script Date: 18/04/2022 02:50:56 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Usuario](
	[id_usuario] [int] IDENTITY(1,1) NOT NULL,
	[Apellido] [varchar](200) NULL,
	[Nombre] [varchar](200) NOT NULL,
	[Correo] [varchar](200) NOT NULL,
	[Contrasena] [varchar](200) NOT NULL,
	[Telefono] [varchar](200) NOT NULL,
	[Cuenta] [varchar](200) NULL,
	[Num_documento] [varchar](12) NOT NULL,
	[Tipo_documento] [int] NOT NULL,
	[Compra_realizadas] [int] NOT NULL,
	[Ventas_realizadas] [int] NOT NULL,
	[Valoracion_Venta] [decimal](4, 2) NOT NULL,
	[ValoracionCompra] [decimal](4, 2) NOT NULL,
	[Estado] [tinyint] NOT NULL,
	[direccion] [varchar](200) NULL,
PRIMARY KEY CLUSTERED 
(
	[id_usuario] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
SET IDENTITY_INSERT [dbo].[Detalle_vivienda] ON 
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (1, N'Dormitorios', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (2, N'Baños', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (3, N'Sala de Estar', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (4, N'Comedor', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (5, N'Piscina', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (6, N'Cochera', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (7, N'Mascotas', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (8, N'Parrilla', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (9, N'Cine', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (10, N'Patio Trasero', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (11, N'Cocina', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (12, N'Pisos', 1)
GO
INSERT [dbo].[Detalle_vivienda] ([Id_detalle], [descripcion_detalles], [Status]) VALUES (13, N'Condicion', 1)
GO
SET IDENTITY_INSERT [dbo].[Detalle_vivienda] OFF
GO
INSERT [dbo].[Detalles_casa] ([id_vivienda], [id_detalle], [Cantidad]) VALUES (24, 13, 2)
GO
INSERT [dbo].[Detalles_casa] ([id_vivienda], [id_detalle], [Cantidad]) VALUES (24, 1, 2)
GO
INSERT [dbo].[Detalles_casa] ([id_vivienda], [id_detalle], [Cantidad]) VALUES (24, 2, 3)
GO
INSERT [dbo].[Detalles_casa] ([id_vivienda], [id_detalle], [Cantidad]) VALUES (24, 6, 1)
GO
INSERT [dbo].[Detalles_casa] ([id_vivienda], [id_detalle], [Cantidad]) VALUES (24, 7, 2)
GO
SET IDENTITY_INSERT [dbo].[Imagenes] ON 
GO
INSERT [dbo].[Imagenes] ([Id_Imagenes], [RutasImagenes], [id_publicacion], [tipo]) VALUES (31, N'S69NQo.jpeg', 24, 1)
GO
SET IDENTITY_INSERT [dbo].[Imagenes] OFF
GO
SET IDENTITY_INSERT [dbo].[Oferta] ON 
GO
INSERT [dbo].[Oferta] ([Id_oferta], [Fecha], [Id_publicacion], [Id_usuario], [monto], [estado]) VALUES (11, CAST(N'2022-04-18T13:16:20.300' AS DateTime), 24, 1, CAST(140000.00 AS Decimal(18, 2)), 1)
GO
SET IDENTITY_INSERT [dbo].[Oferta] OFF
GO
SET IDENTITY_INSERT [dbo].[Publicacion] ON 
GO
INSERT [dbo].[Publicacion] ([Id_publicaciones], [Descripcion], [localizacion], [longitud], [latitud], [Precio], [Tipo], [Area], [Status], [Id_usuario], [Titutlo_anuncio], [Favoritos], [Fecha_postventa], [provincia]) VALUES (24, N'Zona cercana al mall', N'Las magnolias', CAST(-79.840000000000 AS Decimal(18, 12)), CAST(-6.770000000000 AS Decimal(18, 12)), CAST(150000.00 AS Decimal(18, 2)), N'Venta', CAST(120.00 AS Decimal(7, 2)), 1, 2, N'Vendo casa en chiclayo', 0, CAST(N'2022-08-18T13:08:49.210' AS DateTime), N'Chiclayo')
GO
SET IDENTITY_INSERT [dbo].[Publicacion] OFF
GO
SET IDENTITY_INSERT [dbo].[Seguimientos] ON 
GO
INSERT [dbo].[Seguimientos] ([Id_seguimiento], [Mensaje], [Fecha_incidente], [Respuesta], [Fecha_respuesta], [Status], [id_oferta]) VALUES (7, N'Inicio de Puja', CAST(N'2022-04-18T13:16:20.300' AS DateTime), N'Oferta Aceptada', CAST(N'2022-04-18T13:17:25.830' AS DateTime), 1, 11)
GO
INSERT [dbo].[Seguimientos] ([Id_seguimiento], [Mensaje], [Fecha_incidente], [Respuesta], [Fecha_respuesta], [Status], [id_oferta]) VALUES (8, N'Vino con defectos en estructuras.', CAST(N'2022-04-18T13:18:10.567' AS DateTime), N'Solucionado con visita el día no sé', CAST(N'2022-04-18T13:18:59.740' AS DateTime), 1, 11)
GO
SET IDENTITY_INSERT [dbo].[Seguimientos] OFF
GO
SET IDENTITY_INSERT [dbo].[TipoDocumento] ON 
GO
INSERT [dbo].[TipoDocumento] ([idTipo], [Descripcion]) VALUES (1, N'LIBRETA ELECTORAL O DNI')
GO
INSERT [dbo].[TipoDocumento] ([idTipo], [Descripcion]) VALUES (2, N'CARNET DE EXTRANJERIA')
GO
INSERT [dbo].[TipoDocumento] ([idTipo], [Descripcion]) VALUES (3, N'REG. UNICO DE CONTRIBUYENTES')
GO
INSERT [dbo].[TipoDocumento] ([idTipo], [Descripcion]) VALUES (4, N'PASAPORTE')
GO
INSERT [dbo].[TipoDocumento] ([idTipo], [Descripcion]) VALUES (5, N'PART. DE NACIMIENTO-IDENTIDAD')
GO
SET IDENTITY_INSERT [dbo].[TipoDocumento] OFF
GO
SET IDENTITY_INSERT [dbo].[Transaccion1] ON 
GO
INSERT [dbo].[Transaccion1] ([ID], [idusuario], [tarjeta], [ccv], [mes], [anio], [monto], [titular]) VALUES (1, 2, N'qwfgeqiyfgeiwf', N'ASD', 10, 2022, CAST(2000.00 AS Decimal(18, 2)), N'pedro sanches')
GO
INSERT [dbo].[Transaccion1] ([ID], [idusuario], [tarjeta], [ccv], [mes], [anio], [monto], [titular]) VALUES (2, 2, N'qwfgeqiyfgeiwf', N'ASD', 10, 2022, CAST(2000.00 AS Decimal(18, 2)), N'pedro sanches')
GO
INSERT [dbo].[Transaccion1] ([ID], [idusuario], [tarjeta], [ccv], [mes], [anio], [monto], [titular]) VALUES (3, 1, N'1234567897410852', N'123', 2, 12, CAST(40.00 AS Decimal(18, 2)), N'asdasdasdasdasdas')
GO
SET IDENTITY_INSERT [dbo].[Transaccion1] OFF
GO
SET IDENTITY_INSERT [dbo].[Usuario] ON 
GO
INSERT [dbo].[Usuario] ([id_usuario], [Apellido], [Nombre], [Correo], [Contrasena], [Telefono], [Cuenta], [Num_documento], [Tipo_documento], [Compra_realizadas], [Ventas_realizadas], [Valoracion_Venta], [ValoracionCompra], [Estado], [direccion]) VALUES (1, N'Stark', N'Tony 1', N'starck@gmail.com', N'á
Ü9IºY«¾VàWòˆ>', N'999666333', N'Premium', N'78945612', 1, 0, 0, CAST(0.00 AS Decimal(4, 2)), CAST(0.00 AS Decimal(4, 2)), 0, N' 1234 #santalilaqwe')
GO
INSERT [dbo].[Usuario] ([id_usuario], [Apellido], [Nombre], [Correo], [Contrasena], [Telefono], [Cuenta], [Num_documento], [Tipo_documento], [Compra_realizadas], [Ventas_realizadas], [Valoracion_Venta], [ValoracionCompra], [Estado], [direccion]) VALUES (2, N'Saldaña Lara', N'Axel Jesus', N'axel.22.11.2000@gmail.com', N'ú¡Üsë<ZpOUCé<ú', N'972798164', N'Premium', N'74606636', 1, 0, 0, CAST(0.00 AS Decimal(4, 2)), CAST(0.00 AS Decimal(4, 2)), 0, NULL)
GO
INSERT [dbo].[Usuario] ([id_usuario], [Apellido], [Nombre], [Correo], [Contrasena], [Telefono], [Cuenta], [Num_documento], [Tipo_documento], [Compra_realizadas], [Ventas_realizadas], [Valoracion_Venta], [ValoracionCompra], [Estado], [direccion]) VALUES (3, N'Aministrador', N'Aministrador', N'goldhouselam@gmail.com', N'%ÕZÒƒª@
ôdÇmq<­', N'973126456', N'Normal', N'12345678', 1, 0, 0, CAST(0.00 AS Decimal(4, 2)), CAST(0.00 AS Decimal(4, 2)), 0, N'administrador usuario')
GO
SET IDENTITY_INSERT [dbo].[Usuario] OFF
GO
ALTER TABLE [dbo].[Detalle_vivienda] ADD  DEFAULT ((1)) FOR [Status]
GO
ALTER TABLE [dbo].[Usuario] ADD  DEFAULT ((0)) FOR [Compra_realizadas]
GO
ALTER TABLE [dbo].[Usuario] ADD  DEFAULT ((0)) FOR [Ventas_realizadas]
GO
ALTER TABLE [dbo].[Usuario] ADD  DEFAULT ((0)) FOR [Valoracion_Venta]
GO
ALTER TABLE [dbo].[Usuario] ADD  DEFAULT ((0)) FOR [ValoracionCompra]
GO
ALTER TABLE [dbo].[Usuario] ADD  DEFAULT ((0)) FOR [Estado]
GO
ALTER TABLE [dbo].[Detalles_casa]  WITH CHECK ADD  CONSTRAINT [pk_transDetalle] FOREIGN KEY([id_detalle])
REFERENCES [dbo].[Detalle_vivienda] ([Id_detalle])
GO
ALTER TABLE [dbo].[Detalles_casa] CHECK CONSTRAINT [pk_transDetalle]
GO
ALTER TABLE [dbo].[Detalles_casa]  WITH CHECK ADD  CONSTRAINT [pk_transVivi] FOREIGN KEY([id_vivienda])
REFERENCES [dbo].[Publicacion] ([Id_publicaciones])
GO
ALTER TABLE [dbo].[Detalles_casa] CHECK CONSTRAINT [pk_transVivi]
GO
ALTER TABLE [dbo].[Imagenes]  WITH CHECK ADD  CONSTRAINT [pk_imgPubli] FOREIGN KEY([id_publicacion])
REFERENCES [dbo].[Publicacion] ([Id_publicaciones])
GO
ALTER TABLE [dbo].[Imagenes] CHECK CONSTRAINT [pk_imgPubli]
GO
ALTER TABLE [dbo].[Oferta]  WITH CHECK ADD  CONSTRAINT [fkofetpubli] FOREIGN KEY([Id_publicacion])
REFERENCES [dbo].[Publicacion] ([Id_publicaciones])
GO
ALTER TABLE [dbo].[Oferta] CHECK CONSTRAINT [fkofetpubli]
GO
ALTER TABLE [dbo].[Oferta]  WITH CHECK ADD  CONSTRAINT [fkofetusu] FOREIGN KEY([Id_usuario])
REFERENCES [dbo].[Usuario] ([id_usuario])
GO
ALTER TABLE [dbo].[Oferta] CHECK CONSTRAINT [fkofetusu]
GO
ALTER TABLE [dbo].[Publicacion]  WITH CHECK ADD  CONSTRAINT [Pk_Publi_Usuario] FOREIGN KEY([Id_usuario])
REFERENCES [dbo].[Usuario] ([id_usuario])
GO
ALTER TABLE [dbo].[Publicacion] CHECK CONSTRAINT [Pk_Publi_Usuario]
GO
ALTER TABLE [dbo].[Seguimientos]  WITH CHECK ADD  CONSTRAINT [fkseguiofe] FOREIGN KEY([id_oferta])
REFERENCES [dbo].[Oferta] ([Id_oferta])
GO
ALTER TABLE [dbo].[Seguimientos] CHECK CONSTRAINT [fkseguiofe]
GO
ALTER TABLE [dbo].[Transaccion1]  WITH CHECK ADD  CONSTRAINT [fk_grupo] FOREIGN KEY([idusuario])
REFERENCES [dbo].[Usuario] ([id_usuario])
GO
ALTER TABLE [dbo].[Transaccion1] CHECK CONSTRAINT [fk_grupo]
GO
ALTER TABLE [dbo].[Usuario]  WITH CHECK ADD  CONSTRAINT [pk_User_TipoDoc] FOREIGN KEY([Tipo_documento])
REFERENCES [dbo].[TipoDocumento] ([idTipo])
GO
ALTER TABLE [dbo].[Usuario] CHECK CONSTRAINT [pk_User_TipoDoc]
GO
/****** Object:  StoredProcedure [dbo].[AceptarOferta]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[AceptarOferta]
@id_oferta int
as
begin 
DECLARE @fecha DATETIME = (SELECT DATEADD(HH, -5, GETDATE()));
	update Oferta set estado = 1 WHERE Id_oferta = @id_oferta;
	UPDATE Seguimientos set Respuesta = 'Oferta Aceptada', Fecha_respuesta = @fecha, Status = 1 WHERE id_oferta = @id_oferta;
	UPDATE Publicacion SET Status = 1 WHERE Id_publicaciones = (select top 1 Id_publicacion FROM Oferta WHERE Id_oferta = @id_oferta);

END
GO
/****** Object:  StoredProcedure [dbo].[AgregarImagenes]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[AgregarImagenes]
@RutasImagenes varchar(200),
@id_publi int,
@tipo tinyint
as
begin
	insert into Imagenes(RutasImagenes, id_publicacion, tipo) values (@RutasImagenes, @id_publi, @tipo)
end
GO
/****** Object:  StoredProcedure [dbo].[AgregarIncidencia]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[AgregarIncidencia]
@Mensaje text,
@id_oferta int
as
begin 
	insert into Seguimientos(Mensaje, Fecha_incidente, Respuesta, Fecha_respuesta, Status, id_oferta) VALUES (@Mensaje, DATEADD(HH, -5, GETDATE()), null, null,0, @id_oferta)

END
GO
/****** Object:  StoredProcedure [dbo].[AgregarOferta]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[AgregarOferta]
@idpublicacion int,
@id_usuario int,
@monto decimal(18,2)
as
begin 
	DECLARE @id INT = 0;
	DECLARE @fecha DATETIME = (SELECT DATEADD(HH, -5, GETDATE()));
	insert into Oferta(Fecha, Id_publicacion, Id_usuario, monto, estado) VALUES (@fecha, @idpublicacion, @id_usuario, @monto,0)
	SET @id = (SELECT top 1 Id_oferta FROM Oferta ORDER BY Id_oferta DESC);
	INSERT INTO Seguimientos (id_oferta,Fecha_incidente,Mensaje,Status) VALUES (@id,@fecha,'Inicio de Puja',0); 
END
GO
/****** Object:  StoredProcedure [dbo].[AgregarRespuesta]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[AgregarRespuesta]
@Respuesta text,
@id_oferta int
as
begin
	UPDATE Seguimientos SET Respuesta = @Respuesta, Fecha_respuesta = DATEADD(HH, -5, GETDATE()),
	Status = 1  where Id_seguimiento = @id_oferta

end
GO
/****** Object:  StoredProcedure [dbo].[AgregarTransaccion]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[AgregarTransaccion]
@monto decimal(18,2),
@iduser int,
@tarjeta varchar(max),
@ccv varchar(3),
@mes int,
@anio int,
@titular varchar(200)
as
begin
	insert into Transaccion1 (monto, idusuario, tarjeta, ccv, mes, anio, titular) values (@monto, @iduser, @tarjeta, @ccv, @mes , @anio, @titular)
end
GO
/****** Object:  StoredProcedure [dbo].[detViviMostrar]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[detViviMostrar]
AS
SELECT Id_detalle, descripcion_detalles FROM Detalle_vivienda WHERE Status = 1;
GO
/****** Object:  StoredProcedure [dbo].[editarUsuario]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[editarUsuario] 
@id int,
@nombre varchar(200),
@apellido varchar(200), 
@correo varchar(200),
@telefono varchar(200),
@cuenta varchar(200),
@direccion varchar(200)
as
begin
	UPDATE Usuario
	SET Nombre = @nombre,Apellido=@apellido,Correo=@correo,Telefono=@telefono,Cuenta=@cuenta, direccion = @direccion
	WHERE id_usuario = @id;
end;


GO
/****** Object:  StoredProcedure [dbo].[imgListaById]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[imgListaById] @idPub INT
AS
BEGIN
	SELECT RutasImagenes FROM Imagenes WHERE id_publicacion = @idPub;
END
GO
/****** Object:  StoredProcedure [dbo].[listarIncidencias]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[listarIncidencias] @idPubli INT
AS
BEGIN
	SELECT ofe.Id_oferta, ofe.Fecha, seg.Mensaje, dbo.retornarRespuesta(seg.Id_seguimiento) AS Resp
	FROM Oferta as ofe inner join Seguimientos as seg ON ofe.Id_oferta=seg.id_oferta
	WHERE ofe.Id_publicacion = @idPubli AND estado = 1;
END;
GO
/****** Object:  StoredProcedure [dbo].[ListarOfertaAceptadaporCliente]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[ListarOfertaAceptadaporCliente]
@Id_usu int
as
begin
	select O.Fecha as fecha, O.Id_publicacion as id_publi, u.Apellido as apellido, u.Nombre as nombre, O.monto as monto
	from Oferta O inner join Publicacion p on O.Id_publicacion = p.Id_publicaciones inner join Usuario u on u.id_usuario = O.Id_usuario
	where O.Id_usuario = @Id_usu and O.estado = 1
end
GO
/****** Object:  StoredProcedure [dbo].[ListarOfertaAceptadas]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[ListarOfertaAceptadas]
@Id_publi int
as
begin
	select O.Fecha, O.Id_publicacion, O.Id_usuario, O.monto
	from Oferta O inner join Publicacion p on O.Id_publicacion = p.Id_publicaciones
	where estado = 1 and O.Id_publicacion = @Id_publi
end
GO
/****** Object:  StoredProcedure [dbo].[ListarOfertaAceptadasPubli]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[ListarOfertaAceptadasPubli]
@Id_usu int
as
begin
	select O.Fecha as fecha, O.Id_publicacion as id_publi, u.Apellido as apellido, u.Nombre as nombre, O.monto as monto
	from Oferta O inner join Publicacion p on O.Id_publicacion = p.Id_publicaciones inner join Usuario u on u.id_usuario = O.Id_usuario
	where O.estado = 1 and p.Id_usuario = @Id_usu
end
GO
/****** Object:  StoredProcedure [dbo].[listarOfertasCulminidas]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[listarOfertasCulminidas] @idPubli INT
AS
BEGIN
	IF EXISTS(SELECT * FROM Oferta WHERE Id_publicacion = (select p.Id_publicaciones from Publicacion p where p.Fecha_postventa < (SELECT DATEADD(HH, -5, GETDATE())) and p.Id_publicaciones = @idPubli) AND estado = 1)
	BEGIN
		SELECT 
		(SELECT US.Nombre from Usuario as US WHERE US.id_usuario = ofr.Id_usuario) AS Nombre,
		ofr.Id_oferta AS id,
		Fecha,
		monto
		FROM Oferta AS ofr
		WHERE Id_publicacion = @idPubli;
	END;
	ELSE
	BEGIN
		SELECT 0 AS id, GETDATE() AS Fecha,''AS Nombre,0.0 AS monto
	END;
END;
GO
/****** Object:  StoredProcedure [dbo].[listarOfertasenCurso]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create PROCEDURE [dbo].[listarOfertasenCurso] @idPubli INT
AS
BEGIN
	IF EXISTS(SELECT * FROM Oferta WHERE Id_publicacion = (select p.Id_publicaciones from Publicacion p where p.Fecha_postventa > (SELECT DATEADD(HH, -5, GETDATE())) and p.Id_publicaciones = @idPubli) AND estado = 1)
	BEGIN
		SELECT 
		(SELECT US.Nombre from Usuario as US WHERE US.id_usuario = ofr.Id_usuario) AS Nombre,
		ofr.Id_oferta AS id,
		Fecha,
		monto
		FROM Oferta AS ofr
		WHERE Id_publicacion = @idPubli;
	END;
	ELSE
	BEGIN
		SELECT 0 AS id, GETDATE() AS Fecha,''AS Nombre,0.0 AS monto
	END;
END;
GO
/****** Object:  StoredProcedure [dbo].[listarOfertasPendientes]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[listarOfertasPendientes] @idPubli INT
AS
BEGIN
	IF EXISTS(SELECT * FROM Oferta WHERE Id_publicacion = @idPubli AND estado = 0)
	BEGIN
		SELECT 
		(SELECT US.Nombre from Usuario as US WHERE US.id_usuario = ofr.Id_usuario) AS Nombre,
		ofr.Id_oferta AS id,
		Fecha,
		monto
		FROM Oferta AS ofr
		WHERE Id_publicacion = @idPubli;
	END;
	ELSE
	BEGIN
		SELECT 0 AS id, GETDATE() AS Fecha,''AS Nombre,0.0 AS monto
	END;
END;
GO
/****** Object:  StoredProcedure [dbo].[listarSeguimientos]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[listarSeguimientos] @idOferta INT
AS
BEGIN
	SELECT Id_seguimiento AS IdSeg,id_oferta AS idOf ,Fecha_incidente as Fecha, Mensaje,[dbo].[retornarRespuesta](Id_seguimiento) AS Estado FROM Seguimientos where id_oferta = @idOferta AND Mensaje not like 'Inicio de Puja';
END;
GO
/****** Object:  StoredProcedure [dbo].[maximoMinimoFiltros]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--CREATE PROCEDURE publicacionFiltros
--@Descripcion VARCHAR(150),
--@latitud DECIMAL(18,2),
--@longitud DECIMAL(18,2),
--@precioMin DECIMAL(18,2),
--@precioMax DECIMAL(18,2),
--@tipo VARCHAR(50),
--@areaMin DECIMAL(7,2),
--@areaMax DECIMAL(7,2),
--@mesesPostVenta SMALLINT
--AS
--BEGIN

--END;

CREATE PROCEDURE [dbo].[maximoMinimoFiltros]
AS
BEGIN
	SELECT  ISNULL(MAX(Precio),0) AS 'MaximoPrecio', 
	ISNULL(MIN(Precio),0) AS 'MinimoPrecio',
	ISNULL(MAX(Area),0) AS 'MaximaArea',
	ISNULL(MIN(Area),0) AS 'MinimaArea'
	FROM Publicacion WHERE Status = 0;
END;



GO
/****** Object:  StoredProcedure [dbo].[publiAgregar]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[publiAgregar]
@desc VARCHAR(200),
@localizacion VARCHAR(200),
@lat DECIMAL(18,2),
@long DECIMAL(18,2),
@precio DECIMAL(18,2),
@tipo VARCHAR(50),
@area DECIMAL(7,2),
@titulo VARCHAR(200),
@favorito bit,
@postVenta datetime,
@idUser INT,
@provincia varchar(200)
AS
BEGIN

	INSERT INTO [dbo].[Publicacion]
           ([Descripcion]
           ,[localizacion]
           ,[longitud]
           ,[latitud]
           ,[Precio]
           ,[Tipo]
           ,[Area]
           ,[Status]
           ,[Id_usuario]
           ,[Titutlo_anuncio]
           ,[Favoritos]
           ,[Fecha_postventa]
		   , [provincia])
     VALUES
	 (@desc,@localizacion,@long,@lat,@precio,@tipo,@area,0,@idUser,@titulo,@favorito,@postVenta, @provincia)

	SELECT TOP 1 Id_publicaciones FROM Publicacion ORDER BY Id_publicaciones DESC;

END;
GO
/****** Object:  StoredProcedure [dbo].[publiAgregarDetallePubli]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[publiAgregarDetallePubli]
(
@idPubli int,
@idDetalle int,
@Cantidad int
)
AS
BEGIN
	INSERT INTO Detalles_casa values(@idPubli,@idDetalle,@Cantidad);
END;
GO
/****** Object:  StoredProcedure [dbo].[publicacionComprasUsu]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[publicacionComprasUsu] @idUsu INT
AS
BEGIN

SELECT
	pub.Id_publicaciones AS 'Id',
	pub.Titutlo_anuncio AS 'Titulo',
	pub.localizacion,
	pub.Precio,
	pub.Area,
	pub.Id_usuario AS Vendedor,
	ofe.Id_oferta AS IdOf ,
	(SELECT TOP 1 RutasImagenes FROM Imagenes WHERE id_publicacion = pub.Id_publicaciones Order by Id_Imagenes ASC) AS Ruta
	FROM Publicacion AS pub INNER JOIN Oferta AS ofe ON pub.Id_publicaciones = ofe.Id_publicacion
	WHERE ofe.Id_usuario = @idUsu AND ofe.estado = 1 AND pub.Fecha_postventa > GETDATE();
END;
GO
/****** Object:  StoredProcedure [dbo].[publicacionCulminadoUsu]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[publicacionCulminadoUsu] @idUsu INT
AS
BEGIN

SELECT
	pub.Id_publicaciones AS 'Id',
	pub.Titutlo_anuncio AS 'Titulo',
	pub.localizacion,
	pub.Precio,
	ofe.monto,
	pub.Area,
	ofe.Id_oferta AS IdOf ,
	(SELECT TOP 1 RutasImagenes FROM Imagenes WHERE id_publicacion = pub.Id_publicaciones Order by Id_Imagenes ASC) AS Ruta
	FROM Publicacion AS pub INNER JOIN Oferta AS ofe ON pub.Id_publicaciones = ofe.Id_publicacion
	WHERE pub.Id_usuario = @idUsu AND ofe.estado = 1 and Fecha_postventa < (SELECT DATEADD(HH, -5, GETDATE())); 
END;
GO
/****** Object:  StoredProcedure [dbo].[publicacionenprocesoUsu]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[publicacionenprocesoUsu] @idUsu INT
AS
BEGIN

SELECT
	pub.Id_publicaciones AS 'Id',
	pub.Titutlo_anuncio AS 'Titulo',
	pub.localizacion,
	pub.Precio,
	ofe.monto,
	pub.Area,
	ofe.Id_oferta AS IdOf ,
	(SELECT TOP 1 RutasImagenes FROM Imagenes WHERE id_publicacion = pub.Id_publicaciones Order by Id_Imagenes ASC) AS Ruta
	FROM Publicacion AS pub INNER JOIN Oferta AS ofe ON pub.Id_publicaciones = ofe.Id_publicacion
	WHERE pub.Id_usuario = @idUsu AND ofe.estado = 1 and Fecha_postventa >= (SELECT DATEADD(HH, -5, GETDATE())); 
END;
GO
/****** Object:  StoredProcedure [dbo].[publicacionFiltros]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[publicacionFiltros]
@descripcion VARCHAR(150),
@localizacion VARCHAR(200),
@titulo VARCHAR(200),
@precioMin DECIMAL(18,2),
@precioMax DECIMAL(18,2),
--@tipo VARCHAR(50),
@provincia varchar(200),
@areaMin DECIMAL(7,2),
@areaMax DECIMAL(7,2),
@cantBanios SMALLINT,
@cantCuarto SMALLINT,
@piscina BIT,
@pet BIT,
@cochera BIT
AS
BEGIN
	
	DECLARE @precioMaxim DECIMAL(18,2) = @precioMax;
	DECLARE @areaMaxim DECIMAL(7,2) = @areaMax;
	
	IF @precioMax = 0 or @precioMax is null
	BEGIN
		SET @precioMaxim = (SELECT MAX(Precio) FROM Publicacion);
	END;
	IF @areaMax = 0 or @areaMax is null
	BEGIN
		SET @areaMaxim = (SELECT MAX(Area) FROM Publicacion);
	END;
	IF @precioMin IS NULL
	BEGIN
		SET @precioMin = 0;
	END;
	IF @areaMin IS NULL
	BEGIN
		SET @areaMin = 0;
	END;
	IF @cantCuarto IS NULL or @cantCuarto = 0
	BEGIN
		SET @cantCuarto = 0;
	END;
	IF @cantBanios IS NULL or @cantBanios = 0
	BEGIN
		SET @cantBanios = (select max(Cantidad) from Detalles_casa where  id_detalle = 2 );
	END;
	IF @piscina IS NULL
	BEGIN
		SET @piscina = 0;
	END;
	IF @pet IS NULL
	BEGIN
		SET @pet = 0;
	END;
	IF @cochera IS NULL
	BEGIN
		SET @cochera = 0;
	END;
	--IF not exists (SELECT distinct id_vivienda FROM Detalles_casa 
	--	WHERE (id_detalle = 1 AND Cantidad >=@cantCuarto)
	--	and (id_detalle = 2 AND Cantidad >= @cantBanios)
	--	and (id_detalle = 5 AND Cantidad like @piscina)
	--	and (id_detalle = 6 AND Cantidad LIKE @pet)
	--	and (id_detalle = 7 AND Cantidad like @cochera))
	--begin
		SELECT Id_publicaciones AS Id, Titutlo_anuncio AS Titulo,
			Favoritos,
			Precio,
			Area,
			Descripcion,
			Tipo, provincia FROM Publicacion
		WHERE 
		(
			(
			(Area BETWEEN @areaMin AND @areaMaxim) AND
			(Precio BETWEEN @precioMin AND @precioMaxim)
			)
		AND
			(
			Titutlo_anuncio LIKE CONCAT('%',@titulo,'%') OR 
			Descripcion LIKE CONCAT('%',@descripcion,'%') OR
			localizacion LIKE CONCAT('%',@localizacion,'%')OR
			provincia LIKE CONCAT('%',@provincia,'%')
			) 
		)and(
		Id_publicaciones IN (
			SELECT distinct id_vivienda FROM Detalles_casa 
			WHERE 
			(id_detalle = 5 AND Cantidad = @piscina)
			or (id_detalle = 6 AND Cantidad = @pet)
			or (id_detalle = 7 AND Cantidad = @cochera)
			or (id_detalle = 1 AND Cantidad >=@cantCuarto)
			and (id_detalle = 2 AND Cantidad >= @cantBanios)
		)
		) AND
		Status = 0
		ORDER BY Favoritos DESC;
		end;
	--else
	--	begin
	--		SELECT Id_publicaciones AS Id,
	--		Titutlo_anuncio AS Titulo,
	--		Favoritos,
	--		Precio,
	--		Area,
	--		Descripcion,
	--		Tipo, provincia
	--		FROM Publicacion
	--		WHERE 
	--		(
	--			(
	--				(Area BETWEEN @areaMin AND @areaMaxim) AND
	--				(Precio BETWEEN @precioMin AND @precioMaxim) 
	--	--			AND	Tipo like @tipo 
	--			)
	--		AND
	--		(
	--		Titutlo_anuncio LIKE CONCAT('%',@titulo,'%') OR 
	--		Descripcion LIKE CONCAT('%',@descripcion,'%') OR
	--		localizacion LIKE CONCAT('%',@localizacion,'%')OR
	--		provincia LIKE CONCAT('%',@provincia,'%')
	--		) 
	--		)and
	--		(
	--		Id_publicaciones IN (
	--		SELECT distinct id_vivienda FROM Detalles_casa 
	--		WHERE (id_detalle = 1 AND Cantidad >=@cantCuarto)
	--		OR (id_detalle = 2 AND Cantidad >= @cantBanios)
	--		OR (id_detalle = 5 AND Cantidad like @piscina)
	--		OR (id_detalle = 6 AND Cantidad LIKE @pet)
	--		OR (id_detalle = 7 AND Cantidad like @cochera) 
	--		)
	--		) 
	--		AND
	--		Status = 0
	--		ORDER BY Favoritos DESC;
	--end;
--END;

GO
/****** Object:  StoredProcedure [dbo].[publicacionFiltros1]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[publicacionFiltros1]
@descripcion VARCHAR(150),
@localizacion VARCHAR(200),
@titulo VARCHAR(200),
@precioMin DECIMAL(18,2),
@precioMax DECIMAL(18,2),
@provincia varchar(200),
@areaMin DECIMAL(7,2),
@areaMax DECIMAL(7,2),
@cantBanios SMALLINT,
@cantCuarto SMALLINT,
@pet BIT,
@cochera BIT
AS
BEGIN
	DECLARE @precioMaxim DECIMAL(18,2) = @precioMax;
	DECLARE @areaMaxim DECIMAL(7,2) = @areaMax;
	
	IF @precioMax = 0 or @precioMax is null
	BEGIN
		SET @precioMaxim = (SELECT MAX(Precio) FROM Publicacion);
	END;
	IF @areaMax = 0 or @areaMax is null
	BEGIN
		SET @areaMaxim = (SELECT MAX(Area) FROM Publicacion);
	END;
	IF @precioMin IS NULL
	BEGIN
		SET @precioMin = 0;
	END;
	IF @areaMin IS NULL
	BEGIN
		SET @areaMin = 0;
	END;
	IF @cantBanios = 0
	BEGIN
		SET @cantBanios = null
	END;
	IF @cantCuarto = 0
	BEGIN
		SET @cantCuarto = null
	END;
	IF @pet = 0
	BEGIN
		SET @pet = null
	END;
	IF @cochera = 0
	BEGIN
		SET @cochera = null
	END;
	SELECT Id_publicaciones AS Id, Titutlo_anuncio AS Titulo,
			Favoritos,
			Precio,
			Area,
			Descripcion,
			Tipo, provincia FROM Publicacion
		WHERE 
		(
			(
			(Area BETWEEN @areaMin AND @areaMaxim) AND
			(Precio BETWEEN @precioMin AND @precioMaxim)
			)
		AND
			(
			Titutlo_anuncio LIKE CONCAT('%',@titulo,'%') OR 
			Descripcion LIKE CONCAT('%',@descripcion,'%') OR
			localizacion LIKE CONCAT('%',@localizacion,'%')OR
			provincia LIKE CONCAT('%',@provincia,'%')
			) 
		)and(
		Id_publicaciones IN (
			
			SELECT distinct id_vivienda FROM Detalles_casa 
			WHERE 
			--(id_detalle = 6 AND Cantidad = @pet)
			--or (id_detalle = 7 AND Cantidad = @cochera) or
			 (id_detalle = 1 AND Cantidad >=@cantCuarto)
			or (id_detalle = 2 AND Cantidad >= @cantBanios)
		)
		
		) AND
		Status = 0
		ORDER BY Favoritos DESC;
		end;



GO
/****** Object:  StoredProcedure [dbo].[publicacionListar]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[publicacionListar]
AS
BEGIN
	SELECT Id_publicaciones AS Id,
	Titutlo_anuncio AS Titulo,
	Favoritos,
	Descripcion,
	Precio,
	Area,
	Tipo,
	provincia
	FROM Publicacion
	WHERE Status = 0
	ORDER BY Favoritos DESC;
END;
GO
/****** Object:  StoredProcedure [dbo].[publicacionSeleccionar]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[publicacionSeleccionar]
@idPubli Int
AS 
BEGIN
	SELECT
	pub.Titutlo_anuncio AS 'Titulo',
	pub.Descripcion,
	pub.localizacion,
	pub.latitud,
	pub.longitud,
	pub.Precio,
	pub.Area,
	pub.Tipo,
	pub.provincia,
	detCa.id_detalle AS 'IdDetalle',
	detCa.Cantidad AS 'Cantidad',
	detViv.descripcion_detalles AS 'Detalle'
	FROM Publicacion AS pub 
	INNER JOIN Detalles_casa AS detCa ON pub.Id_publicaciones=detCa.id_vivienda
	INNER JOIN Detalle_vivienda AS detViv ON detViv.Id_detalle = detCa.id_detalle
	WHERE pub.Status=0 AND pub.Id_publicaciones=@idPubli;
END;
GO
/****** Object:  StoredProcedure [dbo].[publicacionSeleccionarUsu]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[publicacionSeleccionarUsu] @idUsu INT
AS
BEGIN

SELECT (pub.Id_publicaciones) AS 'Id',
	pub.Titutlo_anuncio AS 'Titulo',
	pub.localizacion,
	pub.Precio,
	pub.Area,
	CASE dbo.vendida(pub.Id_publicaciones)
		WHEN 1 THEN 'Vendida'
		WHEN 0 THEN 'No vendida'
	END AS Estado,
	(SELECT TOP 1 RutasImagenes FROM Imagenes WHERE id_publicacion = pub.Id_publicaciones Order by Id_Imagenes ASC) AS Ruta
	FROM Publicacion AS pub 
	WHERE pub.Id_usuario = @idUsu and dbo.vendida(pub.Id_publicaciones) =0;
END;
GO
/****** Object:  StoredProcedure [dbo].[RechazarOferta]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[RechazarOferta] @idOferta INT,@mensaje VARCHAR(200)
AS
BEGIN
	DECLARE @fecha DATETIME = (SELECT DATEADD(HH, -5, GETDATE()));
	update Oferta set estado = 2 WHERE Id_oferta = @idOferta;
	UPDATE Seguimientos set Respuesta = @mensaje, Fecha_respuesta = @fecha, Status = 2 WHERE id_oferta = @idOferta;

END;
GO
/****** Object:  StoredProcedure [dbo].[SeguiListarComprador]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create procedure [dbo].[SeguiListarComprador]
@id int
as
begin
	select s.Mensaje as Men, s.Fecha_incidente as FechaInc, s.Respuesta as Resp, s.Fecha_respuesta as FechaResp, s.Status as estado
	from Seguimientos s inner join Oferta O 
	on s.id_oferta = O.Id_oferta
	where O.Id_oferta = @id
end
GO
/****** Object:  StoredProcedure [dbo].[SeguiListarVendidos]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[SeguiListarVendidos]
@id int
as
begin
	select s.Mensaje as Men, s.Fecha_incidente as FechaInc, s.Status as estado
	from Seguimientos s inner join Oferta O 
	on s.id_oferta = O.Id_oferta inner join Publicacion p on p.Id_publicaciones = O.Id_publicacion
	where p.Id_usuario = @id

end	
GO
/****** Object:  StoredProcedure [dbo].[upgradearCuenta]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create PROCEDURE [dbo].[upgradearCuenta] 
@id int
as
begin
	UPDATE Usuario
	SET Cuenta='Premium'
	WHERE id_usuario = @id;
end;

select * from Usuario
GO
/****** Object:  StoredProcedure [dbo].[userForgotPass]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--ALTER PROCEDURE dbo.Userlogin @dni varchar(12),@pass VARCHAR(200)
--as
--begin
--	DECLARE @password VARCHAR(200) = HashBytes('MD5', @pass);
--	SELECT id_usuario AS 'Id', Nombre,Apellido,Correo,Telefono 
--	FROM Usuario WHERE Num_documento = @dni AND Contrasena like @password;
--end;

--CREATE PROCEDURE UserRegistro 
--@nombre varchar(200),
--@apellido varchar(200), 
--@correo varchar(200),
--@pass varchar(200),
--@telefono varchar(200),
--@cuenta varchar(200),
--@numDoc varchar(12),
--@tipoDocumento int
--as
--begin
--	DECLARE @password VARCHAR(200)=HashBytes('MD5', @pass);
--	INSERT INTO Usuario (Apellido,Nombre,Correo,Contrasena,Telefono,Cuenta,Num_documento,Tipo_documento)
--	VALUES (@apellido,@nombre,@correo,@password,@telefono,@cuenta,@numDoc,@tipoDocumento);
--end;

--CREATE PROCEDURE editarUsuario 
--@id int,
--@nombre varchar(200),
--@apellido varchar(200), 
--@correo varchar(200),
--@telefono varchar(200),
--@cuenta varchar(200)
--as
--begin
--	UPDATE Usuario
--	SET Nombre = @nombre,Apellido=@apellido,Correo=@correo,Telefono=@telefono,Cuenta=@cuenta
--	WHERE id_usuario = @id;
--end;

CREATE PROCEDURE [dbo].[userForgotPass]
@id INT,
@passNew VARCHAR(200)
AS
BEGIN
	DECLARE @password VARCHAR(200)=HashBytes('MD5', @passNew);
	UPDATE Usuario
	SET Contrasena = @password
	WHERE id_usuario = @id;
END;




GO
/****** Object:  StoredProcedure [dbo].[Userlogin]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Userlogin] @dni varchar(12),@pass VARCHAR(200)
as
begin
	DECLARE @password VARCHAR(200) = HashBytes('MD5', @pass);
	SELECT id_usuario AS 'Id', Num_documento as 'DNI',Nombre,Apellido,Correo,Telefono, direccion, Cuenta
	FROM Usuario WHERE Num_documento = @dni AND Contrasena like @password;
end;
GO
/****** Object:  StoredProcedure [dbo].[UserRegistro]    Script Date: 18/04/2022 02:51:03 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--ALTER PROCEDURE dbo.Userlogin @dni varchar(12),@pass VARCHAR(200)
--as
--begin
--	DECLARE @password VARCHAR(200) = HashBytes('MD5', @pass);
--	SELECT id_usuario AS 'Id', Nombre,Apellido,Correo,Telefono 
--	FROM Usuario WHERE Num_documento = @dni AND Contrasena like @password;
--end;

CREATE PROCEDURE [dbo].[UserRegistro] 
@nombre varchar(200),
@apellido varchar(200), 
@correo varchar(200),
@pass varchar(200),
@telefono varchar(200),
@numDoc varchar(12),
@tipoDocumento int,
@direccion varchar(200)
as
begin
	DECLARE @password VARCHAR(200)=HashBytes('MD5', @pass);
	INSERT INTO Usuario (Apellido,Nombre,Correo,Contrasena,Telefono,Cuenta,Num_documento,Tipo_documento, direccion)
	VALUES (@apellido,@nombre,@correo,@password,@telefono,'Normal',@numDoc,@tipoDocumento, @direccion);
end;

GO
